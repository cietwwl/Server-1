//Generated by ConfigCheckerWin tool. Develop by Franky.
//Version:2.0
using System;
using System.IO;
using LitJson;
using ConfigHelper;
using Common;
using LumenWorks.Framework.IO.Csv;
using System.Collections.Generic;

namespace CONFIG_TaoistMagic{

using DictionaryEntry = System.Collections.DictionaryEntry;
using AdapterSource = System.Collections.Generic.IEnumerable<Adapter>;
using Dictionary = System.Collections.Generic.Dictionary<int,TaoistCriticalPlanCfg>;
using KeyValuePair = System.Collections.Generic.KeyValuePair<int,TaoistCriticalPlanCfg>;

public partial class TaoistCriticalPlanCfg:MachineBase
{
  public readonly int key; //关键字段...
  public readonly string sequence; //方案序列...

		public static string[] Headers{
			get{
				string[] headers = {"key","remarks","sequence"};
				return headers;
			}
		}

  private TaoistCriticalPlanCfg(CsvReader csv){
    int.TryParse(csv[0],out this.key);
    this.sequence=csv[2];
  WhenConstructed();
  }

  public TaoistCriticalPlanCfg(Adapter adapter){
	var headers = Headers;
    adapter.tryGetFieldValue<int>(headers[0],out this.key);
    this.sequence=adapter.getFieldValue(headers[2]);
  WhenConstructed();
  }

		public static void Load(AdapterSource sources){
			if (cfgdict == null) {
			   cfgdict = Create(sources);
			   OnDictionaryCreated.DoOnceNull();
			}
		}

		public static Dictionary Create(AdapterSource sources){
			Dictionary result = new Dictionary();
			foreach(var item in sources){
				int key = item.getFieldValue<int>("key");
				result.Add(key, new TaoistCriticalPlanCfg(item));
			}
			return null;
		}

		public bool GetByFieldName<T>(string fieldName,out T value)
		{
			object val;
			bool result = true;
			if (string.Compare(fieldName,"key",true) == 0){
				val = this.key;
			}else
			if (string.Compare(fieldName,"sequence",true) == 0){
				val = this.sequence;
			}else
			{
				val = default(T);
				result = false;
			}
			try {
				value = (T)val;
			} catch (Exception ex) {
				value = default(T);
				result = false;
			}
			return result;
		}

  private static TaoistCriticalPlanCfg CreateFrom(CsvReader csv){
  TaoistCriticalPlanCfg result = new TaoistCriticalPlanCfg(csv);
    return result;
  }

		private static void CreateByLine(CsvReader csv,Action<string[],CsvReader,int> oneLine){
			int rowCount = 0;
			csv.MissingFieldAction = MissingFieldAction.ReplaceByNull;
			string [] headers = csv.GetFieldHeaders();
			while (csv.ReadNextRecord()){
				rowCount++;
				try{
					oneLine(headers,csv,rowCount);
				}catch(System.Exception e){
					GameDebug.LogException(e,"key name={1}, line = {0}",rowCount,csv[0]);
				}
			}
		}

		public static void CreateByMeta(string configName,Action<string[],CsvReader,int> oneLine){
			if (oneLine == null) return;
			ConfigHelper.AutoConfigMgr.UseResouce(configName,delegate(TextReader reader) {
				CustomLoader(reader,oneLine);
			});
		}

		public static void CreateByMeta(Action<string[],CsvReader,int> oneLine){
			CreateByMeta(cfgfilename,oneLine);
		}

		public static void CustomLoader(TextReader reader,Action<string[], CsvReader, int> oneLine){
				try{
					using (CsvReader csv  = new CsvReader(reader,AutoConfigMgr.csvFileHasHeader)){
						csv.MissingFieldAction = MissingFieldAction.ReplaceByNull;
						CreateByLine(csv,oneLine);
					}
				}catch(Exception e){
					GameDebug.LogException(e);
				}
		}

		public static Dictionary Create(TextReader reader){
				Dictionary result = new Dictionary(10);
			CustomLoader(
				reader,delegate(string[] headers, CsvReader csv, int rowCount){
          int key = int.Parse(csv[0]);
				result.Add(key, CreateFrom(csv));
			});
			return result;
		}

		public static void Load(TextReader reader){
			if (cfgdict == null) {
			   cfgdict = Create(reader);
			   OnDictionaryCreated.DoOnceNull();
			}
		}

		//two predicates return false mean to skip current line
		private static void CreateOneLine(CsvReader csv,Dictionary dict,Predicate<int> keyPred,Predicate<TaoistCriticalPlanCfg> linePred = null){
			int key = int.Parse(csv[0]);
			if (keyPred != null && !keyPred(key)) return;
			var line = CreateFrom(csv);
			if (linePred != null && !linePred(line)) return;
			dict.Add(key,line);
		}
		private static Dictionary CreateByFilter(CsvReader csv,Dictionary dict,Predicate<int> keyPred,Predicate<TaoistCriticalPlanCfg> linePred = null){
			if (keyPred == null && linePred == null) return null;
			Dictionary result = new Dictionary();
			CreateByMeta(delegate(string[] headers, CsvReader lineCsv, int rowCount) {
				CreateOneLine(lineCsv,result,keyPred,linePred);
			});
			return result;
		}
  //must be UTF-8 encoding without any headers (the first 4 lines must strip from csv)
  public static Dictionary Create(){
    Dictionary result = new Dictionary(10);
    CreateByMeta(delegate(string[] headers, CsvReader csv, int rowCount) {
          int key = int.Parse(csv[0]);
          result.Add(key,CreateFrom(csv));
    });
    return result;
  }

  public const string cfgfilename="Assets/Config/TaoistMagic/TaoistCriticalPlanCfg.csv";
  private static Dictionary cfgdict = null;
  public static void Load(){
	  if (cfgdict == null) {
	     cfgdict = Create ();
	     OnDictionaryCreated.DoOnceNull();
	  }
  }
  public static Dictionary UnLoad(){
	  Dictionary release = cfgdict;
	  cfgdict = null;
	  return release;
  }

  public static void LoadAsyn(Action act){
  	MultiTasks.UIThreadEventMgr.RunNonUITask(delegate {
  		Load ();
  	},delegate(FP.Maybe<Exception> result) {
  		result.doIfSomething(delegate(Exception arg) {
  			GameDebug.LogException(arg);
  		});
  		if (act != null) act();
  	});
  }
  //will load synchronized (usually in UI thread) if not loaded
  public static TaoistCriticalPlanCfg GetByKey(int key){
  	Load();
  try{
  	    if (key == null) return null;
  	    TaoistCriticalPlanCfg value;
  	    cfgdict.TryGetValue(key,out value);
  	    return value;
  }catch (Exception e){
  	GameDebug.LogException(e);
  	return null;
  }
  }

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<KeyValuePair> Get(Predicate<KeyValuePair> match){
		Load();
		try{
			return cfgdict.Filter(match);
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<int> Keys(){
		Load();
		try{
			return cfgdict.Keys;
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<TaoistCriticalPlanCfg> Values(){
		Load();
		try{
			return cfgdict.Values;
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

}
}

namespace ConfigHelper{
	internal partial class TaoistMagicTaoistCriticalPlanCfgController:ConfigController{
		public override void Load(){
			CONFIG_TaoistMagic.TaoistCriticalPlanCfg.Load();
		}
		public override void UnLoad(){
			CONFIG_TaoistMagic.TaoistCriticalPlanCfg.UnLoad();
		}
		public override string name {get{
				return CONFIG_TaoistMagic.TaoistCriticalPlanCfg.cfgfilename;
			}
		}
		public override void CreateByMeta(string configName,Action<string[],CsvReader,int> oneLine){
			CONFIG_TaoistMagic.TaoistCriticalPlanCfg.CreateByMeta(configName,oneLine);
		}
	}
	public partial class CSVConfigCollection{
			TaoistMagicTaoistCriticalPlanCfgController TaoistMagicTaoistCriticalPlanCfgControllerInstance = new TaoistMagicTaoistCriticalPlanCfgController();
	}
}
