//Generated by ConfigCheckerWin tool. Develop by Franky.
//Version:2.0
using System;
using System.IO;
using LitJson;
using ConfigHelper;
using Common;
using LumenWorks.Framework.IO.Csv;
using System.Collections.Generic;

namespace CONFIG_TaoistMagic{

using DictionaryEntry = System.Collections.DictionaryEntry;
using AdapterSource = System.Collections.Generic.IEnumerable<Adapter>;
using Dictionary = System.Collections.Generic.Dictionary<int,TaoistMagiclCfg>;
using KeyValuePair = System.Collections.Generic.KeyValuePair<int,TaoistMagiclCfg>;

public partial class TaoistMagiclCfg:MachineBase
{
  public readonly int key; //key...
  public readonly string skillName; //技能名字...
  public readonly int tagNum; //分页...
  public readonly int openLevel; //分页开放等级...
  public readonly int order; //序号...
  public readonly string skillIcon; //技能图标...
  public readonly string attribute; //属性类型...
  public readonly string formulaParam; //属性计算公式参数...
  public readonly AttrValueType attrValueType; //属性值的类型...
  public readonly int consumeId; //技能消耗ID...

		public static string[] Headers{
			get{
				string[] headers = {"key","remarks","skillName","tagNum","openLevel","order","skillIcon","attribute","formulaParam","attrValueType","consumeId"};
				return headers;
			}
		}

  private TaoistMagiclCfg(CsvReader csv){
    int.TryParse(csv[0],out this.key);
    this.skillName=csv[2];
    int.TryParse(csv[3],out this.tagNum);
    int.TryParse(csv[4],out this.openLevel);
    int.TryParse(csv[5],out this.order);
    this.skillIcon=csv[6];
    this.attribute=csv[7];
    this.formulaParam=csv[8];
    this.attrValueType=(AttrValueType)Enum.Parse(typeof(AttrValueType),csv[9]);
    int.TryParse(csv[10],out this.consumeId);
  WhenConstructed();
  }

  public TaoistMagiclCfg(Adapter adapter){
	var headers = Headers;
    adapter.tryGetFieldValue<int>(headers[0],out this.key);
    this.skillName=adapter.getFieldValue(headers[2]);
    adapter.tryGetFieldValue<int>(headers[3],out this.tagNum);
    adapter.tryGetFieldValue<int>(headers[4],out this.openLevel);
    adapter.tryGetFieldValue<int>(headers[5],out this.order);
    this.skillIcon=adapter.getFieldValue(headers[6]);
    this.attribute=adapter.getFieldValue(headers[7]);
    this.formulaParam=adapter.getFieldValue(headers[8]);
    this.attrValueType=adapter.getFieldValue<AttrValueType>(headers[9]);
    adapter.tryGetFieldValue<int>(headers[10],out this.consumeId);
  WhenConstructed();
  }

		public static void Load(AdapterSource sources){
			if (cfgdict == null) {
			   cfgdict = Create(sources);
			   OnDictionaryCreated.DoOnceNull();
			}
		}

		public static Dictionary Create(AdapterSource sources){
			Dictionary result = new Dictionary();
			foreach(var item in sources){
				int key = item.getFieldValue<int>("key");
				result.Add(key, new TaoistMagiclCfg(item));
			}
			return null;
		}

		public bool GetByFieldName<T>(string fieldName,out T value)
		{
			object val;
			bool result = true;
			if (string.Compare(fieldName,"key",true) == 0){
				val = this.key;
			}else
			if (string.Compare(fieldName,"skillName",true) == 0){
				val = this.skillName;
			}else
			if (string.Compare(fieldName,"tagNum",true) == 0){
				val = this.tagNum;
			}else
			if (string.Compare(fieldName,"openLevel",true) == 0){
				val = this.openLevel;
			}else
			if (string.Compare(fieldName,"order",true) == 0){
				val = this.order;
			}else
			if (string.Compare(fieldName,"skillIcon",true) == 0){
				val = this.skillIcon;
			}else
			if (string.Compare(fieldName,"attribute",true) == 0){
				val = this.attribute;
			}else
			if (string.Compare(fieldName,"formulaParam",true) == 0){
				val = this.formulaParam;
			}else
			if (string.Compare(fieldName,"attrValueType",true) == 0){
				val = this.attrValueType;
			}else
			if (string.Compare(fieldName,"consumeId",true) == 0){
				val = this.consumeId;
			}else
			{
				val = default(T);
				result = false;
			}
			try {
				value = (T)val;
			} catch (Exception ex) {
				value = default(T);
				result = false;
			}
			return result;
		}

  private static TaoistMagiclCfg CreateFrom(CsvReader csv){
  TaoistMagiclCfg result = new TaoistMagiclCfg(csv);
    return result;
  }

		private static void CreateByLine(CsvReader csv,Action<string[],CsvReader,int> oneLine){
			int rowCount = 0;
			csv.MissingFieldAction = MissingFieldAction.ReplaceByNull;
			string [] headers = csv.GetFieldHeaders();
			while (csv.ReadNextRecord()){
				rowCount++;
				try{
					oneLine(headers,csv,rowCount);
				}catch(System.Exception e){
					GameDebug.LogException(e,"key name={1}, line = {0}",rowCount,csv[0]);
				}
			}
		}

		public static void CreateByMeta(string configName,Action<string[],CsvReader,int> oneLine){
			if (oneLine == null) return;
			ConfigHelper.AutoConfigMgr.UseResouce(configName,delegate(TextReader reader) {
				CustomLoader(reader,oneLine);
			});
		}

		public static void CreateByMeta(Action<string[],CsvReader,int> oneLine){
			CreateByMeta(cfgfilename,oneLine);
		}

		public static void CustomLoader(TextReader reader,Action<string[], CsvReader, int> oneLine){
				try{
					using (CsvReader csv  = new CsvReader(reader,AutoConfigMgr.csvFileHasHeader)){
						csv.MissingFieldAction = MissingFieldAction.ReplaceByNull;
						CreateByLine(csv,oneLine);
					}
				}catch(Exception e){
					GameDebug.LogException(e);
				}
		}

		public static Dictionary Create(TextReader reader){
				Dictionary result = new Dictionary(22);
			CustomLoader(
				reader,delegate(string[] headers, CsvReader csv, int rowCount){
          int key = int.Parse(csv[0]);
				result.Add(key, CreateFrom(csv));
			});
			return result;
		}

		public static void Load(TextReader reader){
			if (cfgdict == null) {
			   cfgdict = Create(reader);
			   OnDictionaryCreated.DoOnceNull();
			}
		}

		//two predicates return false mean to skip current line
		private static void CreateOneLine(CsvReader csv,Dictionary dict,Predicate<int> keyPred,Predicate<TaoistMagiclCfg> linePred = null){
			int key = int.Parse(csv[0]);
			if (keyPred != null && !keyPred(key)) return;
			var line = CreateFrom(csv);
			if (linePred != null && !linePred(line)) return;
			dict.Add(key,line);
		}
		private static Dictionary CreateByFilter(CsvReader csv,Dictionary dict,Predicate<int> keyPred,Predicate<TaoistMagiclCfg> linePred = null){
			if (keyPred == null && linePred == null) return null;
			Dictionary result = new Dictionary();
			CreateByMeta(delegate(string[] headers, CsvReader lineCsv, int rowCount) {
				CreateOneLine(lineCsv,result,keyPred,linePred);
			});
			return result;
		}
  //must be UTF-8 encoding without any headers (the first 4 lines must strip from csv)
  public static Dictionary Create(){
    Dictionary result = new Dictionary(22);
    CreateByMeta(delegate(string[] headers, CsvReader csv, int rowCount) {
          int key = int.Parse(csv[0]);
          result.Add(key,CreateFrom(csv));
    });
    return result;
  }

  public const string cfgfilename="Assets/Config/TaoistMagic/TaoistMagiclCfg.csv";
  private static Dictionary cfgdict = null;
  public static void Load(){
	  if (cfgdict == null) {
	     cfgdict = Create ();
	     OnDictionaryCreated.DoOnceNull();
	  }
  }
  public static Dictionary UnLoad(){
	  Dictionary release = cfgdict;
	  cfgdict = null;
	  return release;
  }

  public static void LoadAsyn(Action act){
  	MultiTasks.UIThreadEventMgr.RunNonUITask(delegate {
  		Load ();
  	},delegate(FP.Maybe<Exception> result) {
  		result.doIfSomething(delegate(Exception arg) {
  			GameDebug.LogException(arg);
  		});
  		if (act != null) act();
  	});
  }
  //will load synchronized (usually in UI thread) if not loaded
  public static TaoistMagiclCfg GetByKey(int key){
  	Load();
  try{
  	    if (key == null) return null;
  	    TaoistMagiclCfg value;
  	    cfgdict.TryGetValue(key,out value);
  	    return value;
  }catch (Exception e){
  	GameDebug.LogException(e);
  	return null;
  }
  }

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<KeyValuePair> Get(Predicate<KeyValuePair> match){
		Load();
		try{
			return cfgdict.Filter(match);
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<int> Keys(){
		Load();
		try{
			return cfgdict.Keys;
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

	//will load synchronized (usually in UI thread) if not loaded
	public static IEnumerable<TaoistMagiclCfg> Values(){
		Load();
		try{
			return cfgdict.Values;
		}catch (Exception e){
			GameDebug.LogException(e);
			return null;
		}
	}

}
}

namespace ConfigHelper{
	internal partial class TaoistMagicTaoistMagiclCfgController:ConfigController{
		public override void Load(){
			CONFIG_TaoistMagic.TaoistMagiclCfg.Load();
		}
		public override void UnLoad(){
			CONFIG_TaoistMagic.TaoistMagiclCfg.UnLoad();
		}
		public override string name {get{
				return CONFIG_TaoistMagic.TaoistMagiclCfg.cfgfilename;
			}
		}
		public override void CreateByMeta(string configName,Action<string[],CsvReader,int> oneLine){
			CONFIG_TaoistMagic.TaoistMagiclCfg.CreateByMeta(configName,oneLine);
		}
	}
	public partial class CSVConfigCollection{
			TaoistMagicTaoistMagiclCfgController TaoistMagicTaoistMagiclCfgControllerInstance = new TaoistMagicTaoistMagiclCfgController();
	}
}
